<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOON</title>
    <link rel="stylesheet" href="style-v2.css">
</head>
<body>

    <div class="title-container">
        <h1 class="main-title">
            <span id="soon-text">SOON</span>
            <span id="today-text" class="today-addition">TODAY</span>
        </h1>
    </div>

    <div class="typing-container" id="typing-container">
        <!-- Sentences will be typed here -->
    </div>

    <div id="button-container">
        <!-- Button will appear here -->
    </div>

    <footer id="footer">
        <p id="holders-count">Loading...</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const typingContainer = document.getElementById('typing-container');
            const buttonContainer = document.getElementById('button-container');
            const soonText = document.getElementById('soon-text');
            const todayText = document.getElementById('today-text');
            const holdersCount = document.getElementById('holders-count');

            // Симулируем счетчик holders (в реальности можно подключить API)
            const simulatedHolders = 1247;
            holdersCount.textContent = `${simulatedHolders} holders chose TODAY`;

            // Глобальный курсор
            let globalCursor = null;

            async function fetchData() {
                try {
                    const response = await fetch('sentences.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    return data.paragraphs;
                } catch (error) {
                    console.error('Error fetching data:', error);
                    typingContainer.innerHTML = '<p>Error loading content.</p>';
                    return [];
                }
            }

            function showCursor(element) {
                if (globalCursor && globalCursor.parentNode) {
                    globalCursor.remove();
                }
                globalCursor = document.createElement('span');
                globalCursor.className = 'cursor';
                element.appendChild(globalCursor);
            }

            function hideCursor() {
                if (globalCursor && globalCursor.parentNode) {
                    globalCursor.remove();
                    globalCursor = null;
                }
            }

            function typeText(element, text, speed) {
                return new Promise(resolve => {
                    let i = 0;
                    showCursor(element);

                    function type() {
                        if (i < text.length) {
                            globalCursor.before(text.charAt(i));
                            i++;
                            setTimeout(type, speed);
                        } else {
                            resolve();
                        }
                    }
                    type();
                });
            }

            async function startTypingAnimation(paragraphs) {
                if (!paragraphs || paragraphs.length === 0) {
                    return;
                }

                let paragraphIndex = 0;

                for (const paragraph of paragraphs) {
                    const paragraphElement = document.createElement('p');

                    // Определяем акцентные фразы
                    const firstSentenceText = paragraph.sentences[0]?.text || '';
                    if (firstSentenceText.includes('Soon may never come')) {
                        paragraphElement.classList.add('emphasis');
                    } else if (firstSentenceText === 'Never.' || firstSentenceText === 'Now.') {
                        paragraphElement.classList.add('big-emphasis');
                    }

                    typingContainer.appendChild(paragraphElement);

                    for (let i = 0; i < paragraph.sentences.length; i++) {
                        const sentence = paragraph.sentences[i];

                        // Показываем курсор во время паузы
                        if (sentence.delay > 0) {
                            showCursor(paragraphElement);
                            await new Promise(resolve => setTimeout(resolve, sentence.delay));
                        }

                        if (i > 0) {
                            if (globalCursor && globalCursor.parentNode) {
                                globalCursor.before(' ');
                            } else {
                                paragraphElement.append(' ');
                            }
                        }

                        await typeText(paragraphElement, sentence.text, sentence.typingSpeed);

                        // Зачеркиваем SOON когда печатается "Soon may never come"
                        if (sentence.text === 'Soon may never come.') {
                            soonText.classList.add('strikethrough');
                        }

                        // Добавляем TODAY после "Never."
                        if (sentence.text === 'Never.') {
                            await new Promise(resolve => setTimeout(resolve, 800));
                            todayText.classList.add('visible');
                        }
                    }

                    // Fade out предыдущих параграфов
                    paragraphIndex++;
                    if (paragraphIndex < paragraphs.length) {
                        const allParagraphs = typingContainer.querySelectorAll('p');
                        allParagraphs.forEach((p, idx) => {
                            if (idx < paragraphIndex) {
                                p.classList.add('faded');
                            }
                        });
                    }
                }

                // Убираем курсор в конце
                hideCursor();

                setTimeout(() => {
                    const buttonWrapper = document.createElement('div');
                    buttonWrapper.className = 'button-wrapper';

                    const button = document.createElement('a');
                    button.href = "https://pump.fun";
                    button.className = 'final-button';
                    button.textContent = 'I choose TODAY';

                    const subtext = document.createElement('div');
                    subtext.className = 'button-subtext';
                    subtext.textContent = `Join ${simulatedHolders} holders on Pump.fun`;

                    buttonWrapper.appendChild(button);
                    buttonWrapper.appendChild(subtext);
                    buttonContainer.appendChild(buttonWrapper);

                    setTimeout(() => {
                        buttonWrapper.classList.add('visible');
                    }, 50);

                }, 1500);
            }

            fetchData().then(startTypingAnimation);
        });
    </script>
</body>
</html>
